<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoGame API Dashboard</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --danger: #ef4444;
            --success: #22c55e;
            --bg: #f3f4f6;
            --panel: #ffffff;
            --border: #e5e7eb;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: 100vh;
            box-sizing: border-box;
        }

        /* Layout */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
        }

        /* Cards & Panels */
        .card {
            background: var(--panel);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        h2, h3 { margin-top: 0; color: #111827; }
        h3 { font-size: 1rem; border-bottom: 2px solid var(--bg); padding-bottom: 8px; margin-bottom: 15px; }

        /* Forms */
        .form-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; color: #4b5563; }
        
        input, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
            box-sizing: border-box;
        }

        /* Buttons */
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover { background-color: var(--primary-hover); }
        button.btn-danger { background-color: var(--danger); }
        button.btn-success { background-color: var(--success); }
        button:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .badge-auth { background: #fee2e2; color: #991b1b; }
        .badge-auth.active { background: #dcfce7; color: #166534; }

        /* Response Window */
        .response-window {
            flex-grow: 1;
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            overflow: auto;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
        }
        
        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }

        pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }

        /* Utility */
        .hidden { display: none; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

    <div class="sidebar">
        
        <div class="card">
            <h3>‚öôÔ∏è Configuration</h3>
            <div class="form-group">
                <label>Games Base URL</label>
                <input type="text" id="gamesBaseUrl" value="http://localhost:8100/api/videogames">
            </div>
            <div class="form-group">
                <label>Auth Base URL</label>
                <input type="text" id="authBaseUrl" value="http://localhost:8100/api/users">
            </div>
            <div class="form-group">
                <label>Auth Status: <span id="authStatus" class="badge badge-auth">Not Logged In</span></label>
            </div>
        </div>

        <div class="card">
            <h3>üîê User Auth</h3>
            <div class="grid-2">
                <button onclick="toggleAuth('login')" id="tabLogin">Login</button>
                <button onclick="toggleAuth('signup')" id="tabSignup" style="background-color: #9ca3af;">Signup</button>
            </div>
            
            <div id="loginForm" style="margin-top: 15px;">
                <div class="form-group"><input type="email" id="loginEmail" placeholder="Email"></div>
                <div class="form-group"><input type="password" id="loginPass" placeholder="Password"></div>
                <button onclick="login()">Log In</button>
            </div>

            <div id="signupForm" class="hidden" style="margin-top: 15px;">
                <div class="form-group"><input type="text" id="signName" placeholder="Name"></div>
                <div class="form-group"><input type="email" id="signEmail" placeholder="Email"></div>
                <div class="form-group"><input type="password" id="signPass" placeholder="Password"></div>
                <div class="form-group"><input type="password" id="signPassConf" placeholder="Confirm Password"></div>
                <button class="btn-success" onclick="signup()">Sign Up</button>
            </div>
        </div>

        <div class="card">
            <h3>üåç Public Routes</h3>
            <div class="grid-2" style="margin-bottom: 10px;">
                <button onclick="getReq('/top-5-rated')">Top 5 Rated</button>
                <button onclick="getReq('/by-type')">Stats By Type</button>
            </div>
            <button onclick="getReq('/all-videogames')" style="margin-bottom: 10px;">Get All Games</button>
            
            <div class="form-group">
                <label>Get by ID</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="fetchId" placeholder="Game ID">
                    <button onclick="getById()" style="width: auto;">Go</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üîç Search Filter</h3>
            <div class="grid-2">
                <div class="form-group"><input type="text" id="sTitle" placeholder="Title"></div>
                <div class="form-group"><input type="text" id="sType" placeholder="Type (e.g. RPG)"></div>
            </div>
            <div class="grid-2">
                <div class="form-group"><input type="number" id="sMinRate" placeholder="Min Rating"></div>
                <div class="form-group"><input type="number" id="sMaxRate" placeholder="Max Rating"></div>
            </div>
            <div class="grid-2">
                <div class="form-group"><input type="number" id="sMinYear" placeholder="Min Year"></div>
                <div class="form-group"><input type="number" id="sMaxYear" placeholder="Max Year"></div>
            </div>
            <button onclick="searchGames()">Search</button>
        </div>

        <div class="card">
            <h3>üõ°Ô∏è Admin (Token Req.)</h3>
            
            <div class="form-group">
                <label>Create / Update Game</label>
                <input type="text" id="pTitle" placeholder="Title">
            </div>
            <div class="grid-2">
                <input type="text" id="pCompany" placeholder="Company">
                <input type="text" id="pType" placeholder="Type">
            </div>
            <div class="grid-2" style="margin-top: 5px;">
                <input type="number" id="pRating" placeholder="Rating (1-5)">
                <input type="number" id="pYear" placeholder="Year">
            </div>
            
            <div style="display:flex; gap:10px; margin-top: 15px;">
                <button class="btn-success" onclick="createGame()">Create</button>
                <button style="background-color: #f59e0b;" onclick="updateGame()">Update (Use ID)</button>
            </div>

            <div class="form-group" style="margin-top: 20px; padding-top:15px; border-top: 1px solid #eee;">
                <label style="color: var(--danger);">Danger Zone</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="deleteId" placeholder="Game ID to Delete">
                    <button class="btn-danger" style="width: auto;" onclick="deleteGame()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="response-window">
            <div class="response-header">
                <span id="reqMethodBadge" style="font-weight:bold; color: #60a5fa;">READY</span>
                <span id="reqUrl" style="font-size: 0.9rem; color: #94a3b8;">Waiting for request...</span>
            </div>
            <pre id="output">No data yet.</pre>
        </div>
    </div>

    <script>
        // --- State ---
        let authToken = null;

        // --- Helpers ---
        const getGamesUrl = () => document.getElementById('gamesBaseUrl').value.replace(/\/$/, "");
        const getAuthUrl = () => document.getElementById('authBaseUrl').value.replace(/\/$/, "");
        
        const log = (method, url, data) => {
            document.getElementById('reqMethodBadge').innerText = method;
            document.getElementById('reqUrl').innerText = url;
            document.getElementById('output').innerText = JSON.stringify(data, null, 2);
        };

        const toggleAuth = (tab) => {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginBtn = document.getElementById('tabLogin');
            const signupBtn = document.getElementById('tabSignup');

            if(tab === 'login') {
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
                loginBtn.style.backgroundColor = 'var(--primary)';
                signupBtn.style.backgroundColor = '#9ca3af';
            } else {
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
                loginBtn.style.backgroundColor = '#9ca3af';
                signupBtn.style.backgroundColor = 'var(--success)';
            }
        };

        const updateAuthStatus = (token) => {
            authToken = token;
            const badge = document.getElementById('authStatus');
            if(token) {
                badge.innerText = "Logged In";
                badge.classList.add('active');
            } else {
                badge.innerText = "Not Logged In";
                badge.classList.remove('active');
            }
        };

        // --- API Calls ---

        async function apiRequest(url, method, body = null, useAuth = false) {
            const headers = { 'Content-Type': 'application/json' };
            if(useAuth) {
                if(!authToken) {
                    alert("‚ö†Ô∏è This action requires a login token!");
                    return;
                }
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            const options = { method, headers };
            if(body) options.body = JSON.stringify(body);

            try {
                document.getElementById('output').innerText = "Loading...";
                const res = await fetch(url, options);
                const data = await res.json();
                
                // If it's a 204 No Content (Delete)
                if(res.status === 204) {
                    log(method, url, { status: 'success', message: 'Deleted successfully (No Content returned)' });
                } else {
                    log(method, url, data);
                }
                
                return data;
            } catch (err) {
                log(method, url, { error: err.message });
            }
        }

        // --- Auth Functions ---
        
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            
            const data = await apiRequest(`${getAuthUrl()}/login`, 'POST', { email, password });
            
            if(data && data.status === 'success') {
                updateAuthStatus(data.token);
            }
        }

        async function signup() {
            const name = document.getElementById('signName').value;
            const email = document.getElementById('signEmail').value;
            const password = document.getElementById('signPass').value;
            const confirmPassword = document.getElementById('signPassConf').value;

            const data = await apiRequest(`${getAuthUrl()}/signup`, 'POST', { name, email, password, confirmPassword });

            if(data && data.status === 'success') {
                updateAuthStatus(data.token);
            }
        }

        // --- Game Functions ---

        async function getReq(endpoint) {
            await apiRequest(`${getGamesUrl()}${endpoint}`, 'GET');
        }

        async function getById() {
            const id = document.getElementById('fetchId').value;
            if(!id) return alert("Enter an ID");
            await apiRequest(`${getGamesUrl()}/${id}`, 'GET');
        }

        async function searchGames() {
            const params = new URLSearchParams();
            
            const add = (id, paramName) => {
                const val = document.getElementById(id).value;
                if(val) params.append(paramName, val);
            };

            add('sTitle', 'title');
            add('sType', 'type');
            add('sMinRate', 'minRating');
            add('sMaxRate', 'maxRating');
            add('sMinYear', 'minReleaseYear');
            add('sMaxYear', 'maxReleaseYear');

            await apiRequest(`${getGamesUrl()}/search?${params.toString()}`, 'GET');
        }

        async function createGame() {
            const body = {
                title: document.getElementById('pTitle').value,
                company: document.getElementById('pCompany').value,
                type: document.getElementById('pType').value,
                rating: document.getElementById('pRating').value,
                releaseYear: document.getElementById('pYear').value
            };
            
            await apiRequest(`${getGamesUrl()}/`, 'POST', body, true);
        }

        async function updateGame() {
            const id = document.getElementById('fetchId').value; // Reuse ID field from read section
            if(!id) return alert("Please enter an ID in the 'Get by ID' box to specify which game to update.");

            // Only send fields that have values
            const body = {};
            const addIfVal = (domId, key) => {
                const val = document.getElementById(domId).value;
                if(val) body[key] = val;
            };

            addIfVal('pTitle', 'title');
            addIfVal('pCompany', 'company');
            addIfVal('pType', 'type');
            addIfVal('pRating', 'rating');
            addIfVal('pYear', 'releaseYear');

            if(Object.keys(body).length === 0) return alert("Fill in at least one field in the Admin form to update.");

            await apiRequest(`${getGamesUrl()}/${id}`, 'PATCH', body, true);
        }

        async function deleteGame() {
            const id = document.getElementById('deleteId').value;
            if(!id) return alert("Enter an ID to delete");
            
            if(confirm("Are you sure you want to delete this game?")) {
                await apiRequest(`${getGamesUrl()}/${id}`, 'DELETE', null, true);
            }
        }

    </script>
</body>
</html>